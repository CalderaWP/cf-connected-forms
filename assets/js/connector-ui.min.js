function init_jsPlumb(){jsPlumb.ready(function(){var t=jsPlumb.getInstance({DragOptions:{cursor:"move",zIndex:2e3},PaintStyle:{lineWidth:2,strokeStyle:"#a3be5f",joinstyle:"round",outlineColor:"#F1F1F1",outlineWidth:1},ConnectionOverlays:[["Arrow",{location:1,width:10,length:8}],["Label",{location:[.5],id:"label",cssClass:"aLabel"}]],Container:"canvas"});deleteEndpoint=function(n){t.deleteEndpoint(n.trigger.data("endpoint")),remove_node(n.trigger.data("id"))},add_newNode=function(n){var e=document.createElement("div"),a=jsPlumbUtil.uuid();e.className="window cf-node form-node",e.id=a,e.dataset.form=n.trigger.data("form"),e.innerHTML="<strong>"+n.trigger.data("name")+'</strong><input type="hidden" class="form-node-position" name="config[node]['+a+'][position]" value=""><input type="hidden" name="config[node]['+a+'][form]" value="'+n.trigger.data("form")+'"><button data-parent="'+a+'" data-form="'+n.trigger.data("form")+'" class="button button-small add-condition" type="button"><span style="font-size: 12px; line-height: 21px;" class="dashicons dashicons-plus"></span></button> <button type="button" class="button button-small remove-node"><span style="font-size: 12px; line-height: 21px;" class="dashicons dashicons-no"></span></button>',e.style.left="0px",e.style.top="0px",t.getContainer().appendChild(e),jQuery(".start-point").length?(e.style.left="130px",e.style.top="-50px",t.addEndpoint(e,o,{anchor:"Continuous"})):(e.className="window cf-node form-node start-point",e.innerHTML+='<input type="hidden" class="form-node-base" name="config[node]['+a+'][base]" value="true">'),t.repaintEverything(),t.draggable(e)},removeNode=function(n){var e=t.getEndpoints(n),a=[];if(e)for(var o=0;o<e.length;o++)a.push(e[o].id),t.deleteEndpoint(e[o]);return t.remove(n),a},redraw_all=function(){t.repaintEverything()};var n={lineWidth:2,strokeStyle:"#738e2f",outlineWidth:1,outlineColor:"#F1F1F1"},e={fillStyle:"#738e2f",strokeStyle:"#738e2f"},a={endpoint:"Dot",paintStyle:{strokeStyle:"#a3be5f",fillStyle:"#ffffff",radius:6,lineWidth:2},isSource:!0,connector:["Flowchart",{stub:[20,20],gap:10,cornerRadius:2,alwaysRespectStubs:!1}],maxConnections:1,connectorHoverStyle:n,dragOptions:{},overlays:[["Label",{label:"",location:[.5,1.5],cssClass:"endpointSourceLabel"}]]},o={endpoint:"Dot",paintStyle:{strokeStyle:"#a3be5f",fillStyle:"#a3be5f",radius:6,lineWidth:2},hoverPaintStyle:e,maxConnections:-1,dropOptions:{hoverClass:"hover",activeClass:"active"},isTarget:!0,overlays:[]};setConnectionLable=function(n,e){var a=t.getEndpoint(e.trigger.data("endpoint"));a&&a.connections.length&&a.connections[0].getOverlay("label").setLabel(n.name)};var i=function(t,n){jQuery("<a>",{"data-modal":"addEndpoint","data-modal-title":"Add Condition Point","data-template":"#conditions-tmpl","data-request":"edit_node","data-modal-width":"580","data-modal-height":"420","data-callback":"baldrickTriggers","data-id":t.id,"data-form":jQuery(this).data("form"),"data-modal-buttons":"Close|"+JSON.stringify({"data-modal-autoclose":"addEndpoint","data-request":"cf_set_endpoint","data-endpoint":n,"data-id":jQuery(this).data("parent"),"class":"button-primary ajax-trigger"})+";Delete|"+JSON.stringify({"data-modal-autoclose":"addEndpoint","data-endpoint":n,"data-request":"deleteEndpoint","data-id":t.id,"class":"button ajax-trigger"})+"|button delete-endpoint"}).baldrick().trigger("click")};addPointHome=function(n,e,o){var d=t.addEndpoint(n,a,{anchor:"Continuous",uuid:e});return d.bind("click",function(t){i(t,e)}),o||t.repaintEverything(),d};var d=function(n,e){t.addEndpoint(n,o,{anchor:"Continuous",uuid:e})},r=jsPlumb.getSelector(".cf-form-canvas .form-node");t.batch(function(){t.bind("connection",function(t,n){var e=cf_get_base_form(),a=jQuery("#cf-conditions-db"),o=e.conditions[t.sourceEndpoint.id];e.conditions[t.sourceEndpoint.id].connect=t.target.id,a.val(JSON.stringify(e)),t.connection.getOverlay("label").setLabel(o.name)}),t.bind("click",function(t){t.endpoints&&t.endpoints.length&&t.endpoints[0].fire("click",t.endpoints[0])}),t.draggable(r,{grid:[20,20]});var n=jsPlumb.getSelector(".condition-point");if(n.length){var e=jQuery("#cf-conditions-db"),a=JSON.parse(e.val()),o={},i={_open_condition:"",conditions:{},forms:a.forms};t.setSuspendDrawing(!0);for(var s=0;s<n.length;s++)if(n[s].dataset.src&&n[s].dataset.to){var l="start"+Math.round(99866*Math.random())+Math.round(99866*Math.random());if(!o[n[s].dataset.to]){var c="end"+Math.round(99866*Math.random())+Math.round(99866*Math.random());d(n[s].dataset.to,c),o[n[s].dataset.to]=c}var u=addPointHome(n[s].dataset.from,l,!0);a.conditions[n[s].dataset.src].id=u.id,i.conditions[u.id]=a.conditions[n[s].dataset.src],t.connect({uuids:[l,o[n[s].dataset.to]],editable:!0}).getOverlay("label").setLabel(n[s].dataset.name)}e.val(JSON.stringify(i)),t.setSuspendDrawing(!1,!0),t.repaintEverything(),t.recalculateOffsets()}}),jsPlumb.fire("jsPlumbFormsLoaded",t)})}var add_newNode,deleteEndpoint,redraw_all;